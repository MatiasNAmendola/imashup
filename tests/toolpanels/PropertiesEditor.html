<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
        "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <title>iMashup PropertiesEditor Test</title>
  <style type="text/css">
    @import "../../../dojo/resources/dojo.css";
    @import "../../../dijit/themes/tundra/tundra.css";
    @import "../../../dijit/themes/dijit.css";
    
	@import "../../toolpanels/templates/Docklet.css";

	@import "../../../dojox/layout/resources/FloatingPane.css"; 
	@import "../../../dojox/layout/resources/ResizeHandle.css"; 

  </style>

  <script type="text/javascript" src="../../../dojo/dojo.js" djConfig="isDebug:true, parseOnLoad: true"></script>
  <script type="text/javascript">
    dojo.require("imashup.toolpanels.PropertiesEditor");
    dojo.require("imashup.core.all");
    dojo.require("doh.runner");

    dojo.addOnLoad(function(){
        doh.register("t",
           [
           	  function test_basicType(t){
           	  	var pe = dijit.byId("pe");
           	  	
                dojo.declare("im", dijit._Widget, {
                	i:"i'm i",
                	j:"i'm fucking j",
                	n:213,
                	b:true,
                	f:false
                });
                var option = {
                    impl_name : 'im',
                    interface: {
                        properties: {
                        	i:{type:'string'}, 
                        	j:{type:'string'},
                        	n:{type:'number'},
                        	b:{type:'boolean'},
                        	f:{type:'boolean'}
                        },
                        methods: {},
                        events: {}
                    }
                };
                var ctm = imashup.core.componentTypeManager;
                ctm.registerComponentType(option);
                var ins = new im();
           	  	pe.setFocusWidget(ins);
           	  	
           	  	var form=pe.formManager.get()[ins.id];
           	  	var o = {
	           	  		im_0:{
	           	  		"i":"new i value",
	           	  		"j":"new j value",
	           	  		"n":999,
	           	  		"b":[],
	           	  		"f":["on"]
	           	  	}
           	  	}
           	  	form.setValues(o)
           	  	pe.saveChanged();
           	  	t.is(ins.i,"new i value");
           	  	t.is(ins.j,"new j value");
           	  	t.is(ins.n,999);
           	  	t.is(ins.b,false);
           	  	t.is(ins.f,true);
           	  	pe.dialog.hide();
           	  	
           	  },
           	  
           	  function test_complexType(t){
           	  	var pe = dijit.byId("pe");
           	  	
                dojo.declare("im2", dijit._Widget, {
                	o:{"o1":2, "o2":{"o3":4},"o4":"valueOf o4"}
                });
                var option = {
                    impl_name : 'im2',
                    interface: {
                        properties: {
                        	o:{type:'object'}
                        },
                        methods: {},
                        events: {}
                    }
                };
                var ctm = imashup.core.componentTypeManager;
                ctm.registerComponentType(option);
                var ins = new im2();
           	  	pe.setFocusWidget(ins);
           	  	
           	  	var oForm = pe.formManager.get()['im2_0.o'];
           	  	oForm.setValues({
           	  		im2_0:{
	           	  		o:{
		           	  		o1:99,
		           	  		o4:"newO4"
		           	  	}
	           	  	}
           	  	});
           	  	oForm = pe.formManager.get()['im2_0.o.o2'];
           	  	oForm.setValues({
           	  		im2_0:{
	           	  		o:{
		           	  		o2:{
		           	  			o3:-99
		           	  		}
		           	  	}
	           	  	}
           	  	});
           	  	pe.saveChanged();
           	  	t.is(ins.o.o1,99);
           	  	t.is(ins.o.o4,"newO4");
           	  	t.is(ins.o.o2.o3,-99);   	  	
           	  },
           	  
           	  function test_destroy(t){
           	  	var pe = dijit.byId("pe");
                dojo.declare("im", dijit._Widget, {
                	o:{o:{o:{weird:true}}}
                });
                var option = {
                    impl_name : 'im',
                    interface: {
                        properties: {
                        	'o':{type:'object'} //I really doubt this would do anything good?
                        },
                        methods: {},
                        events: {}
                    }
                };
                var ctm = imashup.core.componentTypeManager;
                ctm.registerComponentType(option);
                var ins = new im();
                pe.setFocusWidget(ins);

           	  	/*var num = pe.dlgs.length;
           	  	t.is(num,3);
           	  	dojo.forEach(pe.dlgs,function(w){
           	  		dojo.connect(w,"destroy",function(){num--;});
           	  	});
								pe.clear(); //TODO: Not pass here
								pe.setFocusWidget(ins);
           	  	t.is(num,0);*/
           	  }
           ]
        );
        doh.run();
        
    });
  </script>
</head>
<body class="tundra">
  <div id='pe' dojoType="imashup.toolpanels.PropertiesEditor" />
</body>
</html>
